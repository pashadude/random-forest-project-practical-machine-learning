{
    "contents" : "---\ntitle: \"ml-excersize-rf-repeatedcv\"\noutput: html_document\n---\n\n#Installing the libraries and  setting the seed\n```{r}\nlibrary(caret)\nlibrary(psych)\nlibrary(ggplot2)\nlibrary(descr)\nlibrary(randomForest)\nlibrary(corrplot)\nset.seed(3433)\n\n```\n\n#lets load the data\n```{r}\ntraining_data <- read.csv(\"pml-training.csv\", header=T, row.names=1)\ntesting_data <- read.csv(\"pml-testing.csv\", header=T, row.names=1)\n```\n\n#lets look into the data\n```{r}\nsummary(training_data)\ndescribe(training_data)\nsapply(training_data, class)\n```\n\n#a lot of columns contain large share of blank data and #DIV/0!, lets turn em into NA\n```{r}\n\ntraining_data <- read.csv(\"pml-training.csv\", header=T, row.names=1, na.strings = c(\"NA\", \"\",\"#DIV/0!\"))\ntesting_data <- read.csv(\"pml-testing.csv\", header=T, row.names=1, na.strings = c(\"NA\", \"\",\"#DIV/0!\"))\n```\n\n#lets get rid of columns with NA's (NA's form ~ 98% of values in columns where they occure)\n```{r}\ntraining_data <-training_data[,colSums(is.na(training_data)) == 0] \ntesting_data <-testing_data[,colSums(is.na(testing_data)) == 0] \n```\n\n#lets remove analysis-meaningless columns like timestamp, username, window etc.\n```{r}\ntraining_data <- training_data[-(1:6)]\ntesting_data <- testing_data[-(1:6)]\n```\n\n#Now lets split the training dataset foe actual training and validation purposess\n```{r}\ninTrain<-createDataPartition(training_data$classe, p=3/4, list=FALSE)\ntraining<-training_data[inTrain,]\nvalidating<-training_data[-inTrain,]\n```\n\n#Now I will check the correlation among the variables\n```{r}\nCorMx<-abs(cor(training[,-53]))\ncorrplot(CorMx, method = \"color\", tl.cex = 0.8)\n```\n\n\n#the graph shows strong corr, specifically among in belt, accel_arm/magnet_arm,gyros and dumbbell variables groups\n#lets move to random forest (which takes pca analysis and repeated cross-validation\n\n```{r}\npreProc <- preProcess(training[, -53], method = \"pca\", thresh = 0.99)\ntrainingPC <- predict(preProc, training[, -53])\nvalidatingPC <- predict(preProc, validating[,-53])\n\nmodelFit <- train(training$classe ~ ., \n                  method = \"rf\", \n                  data = trainingPC,\n                  trControl = trainControl(method = \"repeatedcv\", number=5, repeats=5))\n```\n\n\n                  \n#cross valdation results show pretty high accuracy ~ 0.98, whle sensitivity and specificity is also rather good, \n#lowest sensitivity is for class C, still it is 0.94 which is pretty high\n\n```{r}\nC1 <- confusionMatrix(validating$classe, predict(modelFit, validatingPC))\nprint(C1)\n```\n\n\n#lets do pca on testing set and run model across the result\n\n```{r}\ntestingPC <- predict(preProc, testing_data[, -53])\nstats<- predict(modelFit, testingPC) \n```\n\n\nConfusion Matrix and Statistics\n\n          Reference\nPrediction    A    B    C    D    E\n         A 1392    2    1    0    0\n         B   15  923   10    1    0\n         C    2   10  837    6    0\n         D    1    0   30  767    6\n         E    0    4   10    7  880\n\nOverall Statistics\n                                          \n               Accuracy : 0.9786          \n                 95% CI : (0.9741, 0.9825)\n    No Information Rate : 0.2875          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.9729          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: A Class: B Class: C Class: D Class: E\nSensitivity            0.9872   0.9830   0.9426   0.9821   0.9932\nSpecificity            0.9991   0.9934   0.9955   0.9910   0.9948\nPos Pred Value         0.9978   0.9726   0.9789   0.9540   0.9767\nNeg Pred Value         0.9949   0.9960   0.9874   0.9966   0.9985\nPrevalence             0.2875   0.1915   0.1811   0.1593   0.1807\nDetection Rate         0.2838   0.1882   0.1707   0.1564   0.1794\nDetection Prevalence   0.2845   0.1935   0.1743   0.1639   0.1837\nBalanced Accuracy      0.9932   0.9882   0.9690   0.9866   0.9940\n\n#lets write the results to files\n```{r}\npml_write_files = function(x){\n  n = length(x)\n  for(i in 1:n){\n    filename = paste0(\"problem_id_\",i,\".txt\")\n    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)\n  }\n}\n\npml_write_files(stats)\n```\n\n",
    "created" : 1408961295643.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "483133569",
    "id" : "97A57BC5",
    "lastKnownWriteTime" : 1408985169,
    "path" : "~/Desktop/pml-task/pml-task-rf-cv.Rmd",
    "project_path" : "pml-task-rf-cv.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}